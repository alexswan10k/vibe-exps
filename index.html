<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Navigator</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #ff7e5f 0%, #feb47b 100%);
            min-height: 100vh;
            color: #fff;
        }
        h1 {
            color: #fff;
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            animation: fadeIn 1s ease-in;
        }
        p {
            text-align: center;
            font-size: 1.2em;
            margin-bottom: 40px;
            opacity: 0.9;
        }
        .project-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        .project-card {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid rgba(255, 107, 107, 0.3);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            animation: slideUp 0.6s ease-out forwards;
            opacity: 0;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 220px;
            text-decoration: none;
            color: inherit;
        }
        .project-card:nth-child(1) { animation-delay: 0.1s; }
        .project-card:nth-child(2) { animation-delay: 0.2s; }
        .project-card:nth-child(3) { animation-delay: 0.3s; }
        .project-card:nth-child(4) { animation-delay: 0.4s; }
        .project-card:nth-child(5) { animation-delay: 0.5s; }
        .project-card:nth-child(6) { animation-delay: 0.6s; }
        .project-card:nth-child(7) { animation-delay: 0.7s; }
        .project-card:nth-child(8) { animation-delay: 0.8s; }
        .project-card:nth-child(9) { animation-delay: 0.9s; }
        .project-card:nth-child(10) { animation-delay: 1.0s; }
        .project-card:nth-child(11) { animation-delay: 1.1s; }
        .project-card:nth-child(12) { animation-delay: 1.2s; }
        .project-card:nth-child(13) { animation-delay: 1.3s; }
        .project-card:nth-child(14) { animation-delay: 1.4s; }
        .project-card:nth-child(15) { animation-delay: 1.5s; }
        .project-card:nth-child(16) { animation-delay: 1.6s; }
        .project-card:nth-child(17) { animation-delay: 1.7s; }
        .project-card:nth-child(18) { animation-delay: 1.8s; }
        .project-card:nth-child(19) { animation-delay: 1.9s; }
        .project-card:nth-child(20) { animation-delay: 2.0s; }
        /* don't bother with anything over 20 because it isn't visible and leads to weird artifacts anyway */
        .project-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
            border-color: rgba(255, 107, 107, 0.6);
            background: rgba(255, 250, 240, 0.95);
        }
        .project-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        .project-card:hover::before {
            left: 100%;
        }
        .project-card h3 {
            margin-top: 0;
            color: #2c3e50;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 10px;
            text-align: left;
        }
        .project-card p {
            color: #555;
            margin: 15px 0;
            line-height: 1.5;
            flex-grow: 1;
            text-align: left;
            font-size: 0.9em;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .search-container {
            text-align: center;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        .search-wrapper {
            position: relative;
            width: 100%;
            max-width: 400px;
            display: flex;
            align-items: center;
        }
        .search-box {
            width: 100%;
            padding: 12px 35px 12px 20px; /* Extra right padding for clear button */
            font-size: 1em;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            outline: none;
        }
        .search-box:focus {
            background: rgba(255, 255, 255, 1);
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
            transform: scale(1.02);
        }
        .clear-search {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #666;
            font-size: 18px;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.2s ease;
            display: none; /* Hidden by default */
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .clear-search:hover {
            background: rgba(0, 0, 0, 0.1);
            color: #333;
        }
        .clear-search.visible {
            display: flex;
        }
        .project-card.hidden {
            display: none;
        }
        .shake-btn {
            background: linear-gradient(45deg, #ff4757, #ff3838);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 71, 87, 0.3);
            outline: none;
        }
        .shake-btn:hover {
            background: linear-gradient(45deg, #ff3838, #ff2828);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 71, 87, 0.4);
        }
        .shake-btn:active {
            transform: translateY(0);
        }

        .category-filters {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .category-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            outline: none;
        }
        .category-btn:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
        }
        .category-btn.active {
            background: linear-gradient(45deg, #ff4757, #ff3838);
            color: white;
        }
        .category-btn.active:hover {
            background: linear-gradient(45deg, #ff3838, #ff2828);
        }

        .filters-section {
            display: block;
        }

        @media (max-width: 768px) {
            .filters-section {
                display: none;
            }
            h1, p {
                display: none;
            }
        }


    </style>
</head>
<body>
    <h1>Project Navigator</h1>
    <p>Welcome! Click on any project below to navigate to its main page.</p>

    <div class="filters-section">
        <div class="category-filters">
            <button class="category-btn active" data-category="other">Other</button>
            <button class="category-btn active" data-category="finance">Finance</button>
            <button class="category-btn active" data-category="education">Education</button>
            <button class="category-btn active" data-category="games">Games</button>
        </div>
    </div>

    <div class="search-container">
        <div class="search-wrapper">
            <input type="text" id="searchInput" placeholder="Search projects... (e.g., 'game html' or 'chatbot')" class="search-box">
            <button id="clearSearch" class="clear-search" title="Clear search">√ó</button>
        </div>
        <button id="shakeButton" class="shake-btn">üåã</button>
    </div>

    <div class="project-grid">
        <a href="planet-generator/index.html" class="project-card" data-category="games">
            <h3>üåç Planet Generator</h3>
            <p>Procedural planet generation tool.</p>
        </a>

        <a href="image-editor.html" class="project-card" data-category="other">
            <h3>üé® HTML Image Editor</h3>
            <p>A powerful image editor with drawing, cropping, and rescaling tools.</p>
        </a>

        <a href="2d-labeller.html" class="project-card" data-category="education">
            <h3>üè∑Ô∏è 2D Image Labeller</h3>
            <p>Interactive tool for creating and managing bounding boxes on images with export/import functionality.</p>
        </a>

        <a href="sprite-sheet-generator.html" class="project-card" data-category="education">
            <h3>üéÆ Sprite Sheet Generator</h3>
            <p>Create sprite sheets from clipboard images with customizable grid and tile sizes.</p>
        </a>

        <a href="colony-sim/index.html" class="project-card" data-category="games">
            <h3>üêú Colony Simulator</h3>
            <p>A colony simulation game.</p>
        </a>

        <a href="car-simulator/index.html" class="project-card" data-category="games">
            <h3>üöó Car Simulator</h3>
            <p>A 3D car driving simulator with physics, procedural towns, and customizable controls.</p>
        </a>

        <a href="gta-style-game/index.html" class="project-card" data-category="games">
            <h3>üöó GTA Style Game</h3>
            <p>A GTA-style driving game.</p>
        </a>

        <a href="lambdasafe-sales-page/index.html" class="project-card" data-category="other">
            <h3>üíº LambdaSafe Sales Page</h3>
            <p>Sales page for LambdaSafe.</p>
        </a>

        <a href="physics-sandbox/index.html" class="project-card" data-category="games">
            <h3>‚öõÔ∏è Physics Sandbox</h3>
            <p>Interactive physics simulation.</p>
        </a>

        <a href="portrait-site/index.html" class="project-card" data-category="other">
            <h3>üñºÔ∏è Portrait Site</h3>
            <p>A portrait website.</p>
        </a>

        <a href="space-game/index.html" class="project-card" data-category="games">
            <h3>üöÄ Space Game</h3>
            <p>A space-themed game.</p>
        </a>

        <a href="space-game-site/index.html" class="project-card" data-category="other">
            <h3>üåå Space Game Site</h3>
            <p>Website for the space game.</p>
        </a>

        <a href="volume-raycaster/index.html" class="project-card" data-category="games">
            <h3>üî¨ Volume Raycaster</h3>
            <p>3D volume rendering with raycasting.</p>
        </a>

        <a href="vector-visualization/index.html" class="project-card" data-category="education">
            <h3>üìê Vector Visualization</h3>
            <p>Interactive 2D and 3D vector operations visualization with dot and cross products.</p>
        </a>

        <a href="alex-cv/index.html" class="project-card" data-category="other">
            <h3>üìÑ Alexander Swan CV</h3>
            <p>Interactive CV showcasing software development expertise with 3D visualizations and animations.</p>
        </a>

        <a href="virtual-pet-simulator/index.html" class="project-card" data-category="games">
            <h3>üêæ Virtual Pet Simulator</h3>
            <p>An interactive virtual pet game where you can care for and play with your digital companion.</p>
        </a>

        <a href="retro-space-shooter/index.html" class="project-card" data-category="games">
            <h3>üöÄ Retro Space Shooter</h3>
            <p>A classic retro-style space shooter game with pixel art graphics and arcade gameplay.</p>
        </a>

        <a href="infinite-maze-explorer/index.html" class="project-card" data-category="games">
            <h3>üåÄ Infinite Maze Explorer</h3>
            <p>Navigate through procedurally generated infinite mazes in this challenging exploration game.</p>
        </a>

        <a href="chatbot-agent/standalone.html" class="project-card" data-category="other">
            <h3>ü§ñ Chatbot Agent</h3>
            <p>An interactive chatbot application with llama2.c-stories15M running in-browser.</p>
        </a>

        <a href="particle-fireworks/index.html" class="project-card" data-category="games">
            <h3>üéÜ Particle Fireworks</h3>
            <p>Interactive fireworks simulation with customizable colors, physics, and choreograph mode for creating sequences.</p>
        </a>

        <a href="dungeon-crawler/index.html" class="project-card" data-category="games">
            <h3>üè∞ Procedural Dungeon Crawler</h3>
            <p>Explore procedurally generated dungeons, fight monsters, collect gold, and level up in this classic RPG adventure.</p>
        </a>

        <a href="hacker-simulator/index.html" class="project-card" data-category="games">
            <h3>üíª Hacker Simulator</h3>
            <p>Experience a terminal-style hacker simulation with command-line interface, filesystem navigation, and cyber challenges.</p>
        </a>

        <a href="modular-synth/index.html" class="project-card" data-category="games">
            <h3>üéõÔ∏è Modular Synth</h3>
            <p>Build and play with a modular synthesizer using drag-and-drop modules, patch cables, and real-time audio synthesis.</p>
        </a>

        <a href="expense-tracker/index.html" class="project-card" data-category="finance">
            <h3>üí∞ Expense Tracker</h3>
            <p>A comprehensive expense tracking tool for managing shared expenses, payments, and balances between people.</p>
        </a>

        <a href="timetracker/index.html" class="project-card" data-category="finance">
            <h3>‚è±Ô∏è Time Tracker</h3>
            <p>Freelancer time tracking tool for logging hours, managing projects, and generating reports.</p>
        </a>

        <a href="rsvp-tool/index.html" class="project-card" data-category="other">
            <h3>üìÖ RSVP Tool</h3>
            <p>Event management tool for creating events, sending invitations, and managing RSVPs.</p>
        </a>

        <a href="multi-note-todo/index.html" class="project-card" data-category="other">
            <h3>üìù Multi-Note Todo App</h3>
            <p>Organize your tasks with multiple notes, each containing their own todo lists with completion tracking.</p>
        </a>

        <a href="goal-setter/index.html" class="project-card" data-category="other">
            <h3>üéØ Goal Setter</h3>
            <p>Advanced hierarchical goal tracking with automatic parent completion, progress sliders, and nested goal management.</p>
        </a>

        <a href="meal-planner/index.html" class="project-card" data-category="other">
            <h3>üçΩÔ∏è Meal Planner</h3>
            <p>Weekly meal planning app with drag-and-drop calendar and local storage for recipes.</p>
        </a>

        <a href="matrix-transformations/index.html" class="project-card" data-category="education">
            <h3>üî¢ Matrix Transformations</h3>
            <p>Interactive visualization of 2D and 3D matrix transformations with real-time controls and canvas rendering.</p>
        </a>

        <a href="workflow-chat/test.html" class="project-card" data-category="other">
            <h3>üîÑ Workflow Planner Test</h3>
            <p>Test the workflow chat prototype with different scenarios for structured task completion.</p>
        </a>

        <a href="virtual-aquarium/index.html" class="project-card" data-category="games">
            <h3>üê† Virtual Aquarium</h3>
            <p>A virtual aquarium prototype with AI learning controls for fish behavior and ecosystem simulation.</p>
        </a>

        <a href="human-authorship-verifier/index.html" class="project-card" data-category="other">
            <h3>‚úçÔ∏è Human Authorship Verifier</h3>
            <p>Cryptographically verify human authorship with behavioral logging, digital signatures, and anonymous user fingerprints.</p>
        </a>

        <a href="human-authorship-verifier/corporate.html" class="project-card" data-category="other">
            <h3>üè¢ HAV Corporate Site</h3>
            <p>Professional corporate website showcasing the Human Authorship Verifier with enterprise features, use cases, and business value proposition.</p>
        </a>

        <a href="webgpu-feature-detector.html" class="project-card" data-category="education">
            <h3>üéÆ WebGPU Feature Detector</h3>
            <p>Comprehensive WebGPU support detection tool that checks browser compatibility, available features, device limits, and provides live compatibility data from caniuse.com.</p>
        </a>

        <a href="personal-expense-survival-calculator/index.html" class="project-card" data-category="finance">
            <h3>üí∞ Personal Expense Survival Calculator</h3>
            <p>Calculate how long your savings will last with inflation and investment risk. Features month-by-month analytics, risk scenarios, and comprehensive financial projections.</p>
        </a>

        <a href="city-builder/index.html" class="project-card" data-category="games">
            <h3>üèôÔ∏è City Builder</h3>
            <p>A 2D city management game where you place buildings, manage resources, and watch your city grow.</p>
        </a>
    </div>



    <div style="text-align: center; margin-top: 40px; padding: 20px; background: rgba(255, 255, 255, 0.1); border-radius: 12px; backdrop-filter: blur(10px);">
        <h2 style="color: #fff; font-size: 1.5em; margin-bottom: 10px; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; gap: 10px;">
            <span style="font-size: 1.2em;">ü§ñ</span>
            About the Vibe Stack
        </h2>
        <p style="color: #fff; font-size: 1em; opacity: 0.9; line-height: 1.5;">
            This entire site was built using Vibe Stack - where AI meets actual development experience! Featuring Cline for AI-assisted coding, the cutting-edge Grok code model for intelligent generation, and VSCode as the battle-tested IDE. Vibe coding is the future - it's going to make traditional developers extinct. Now anyone can build anything - as long as you don't mind the occasional live database being dropped, a few API keys getting leaked, and your production server spontaneously combusting! But remember, even with all this AI wizardry, this was crafted by a senior developer who spent 30-40+ turns wrestling with the AI to get anything remotely functional. The future is soon, but it still needs a human touch!
        </p>
    </div>

    <script>
        const projectComplexities = {
            "planet-generator": 1175,
            "image-editor.html": 1032,
            "sprite-sheet-generator.html": 862,
            "colony-sim": 2700,
            "car-simulator": 866,
            "gta-style-game": 1834,
            "lambdasafe-sales-page": 1128,
            "physics-sandbox": 305,
            "portrait-site": 857,
            "space-game": 456,
            "space-game-site": 926,
            "volume-raycaster": 472,
            "vector-visualization": 417,
            "alex-cv": 2798,
            "virtual-pet-simulator": 905,
            "retro-space-shooter": 572,
            "infinite-maze-explorer": 974,
            "chatbot-agent/standalone.html": 3619,
            "particle-fireworks": 241,
            "dungeon-crawler": 1325,
            "hacker-simulator": 540,
            "modular-synth": 3064,
            "expense-tracker": 1372,
            "timetracker": 583,
            "rsvp-tool": 505,
            "multi-note-todo": 635,
            "goal-setter": 1612,
            "meal-planner": 2512,
            "matrix-transformations": 1437,
            "workflow-chat/test.html": 2660,
            "virtual-aquarium": 2268,
            "human-authorship-verifier": 5651,
            "human-authorship-verifier/corporate.html": 5651,
            "webgpu-feature-detector.html": 1060,
            "personal-expense-survival-calculator": 3376,
            "city-builder": 0
        };

        function getComplexityLevel(loc) {
            if (loc < 500) return { level: 'Low', color: '#4CAF50', icon: 'üü¢' };
            if (loc < 1500) return { level: 'Medium', color: '#FF9800', icon: 'üü°' };
            return { level: 'High', color: '#F44336', icon: 'üî¥' };
        }

        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchInput');
            const clearSearchButton = document.getElementById('clearSearch');
            const shakeButton = document.getElementById('shakeButton');
            const projectGrid = document.querySelector('.project-grid');
            const cards = document.querySelectorAll('.project-card');
            const categoryButtons = document.querySelectorAll('.category-btn');

            // Add complexity badges to cards
            cards.forEach(card => {
                const href = card.getAttribute('href');
                let key = href;
                if (href.endsWith('/index.html')) {
                    key = href.slice(0, -11); // remove /index.html
                }
                const loc = projectComplexities[key];
                if (loc !== undefined) {
                    const complexity = getComplexityLevel(loc);
                    const badge = document.createElement('div');
                    badge.className = 'complexity-badge';
                    badge.innerHTML = `${complexity.icon} ${loc} LOC`;
                    badge.style.cssText = `
                        position: absolute;
                        bottom: 10px;
                        right: 10px;
                        background: ${complexity.color};
                        color: white;
                        padding: 4px 8px;
                        border-radius: 12px;
                        font-size: 0.7em;
                        font-weight: bold;
                        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
                    `;
                    card.style.position = 'relative';
                    card.appendChild(badge);
                }
            });

            function filterCards() {
                const query = searchInput.value.trim().toLowerCase();
                const tokens = query.split(/\s+/).filter(token => token.length > 0);
                const activeCategories = Array.from(categoryButtons).filter(btn => btn.classList.contains('active')).map(btn => btn.dataset.category);

                cards.forEach(card => {
                    const title = card.querySelector('h3').textContent.toLowerCase();
                    const description = card.querySelector('p').textContent.toLowerCase();
                    const combinedText = title + ' ' + description;
                    const matches = tokens.every(token => combinedText.includes(token)) || tokens.length === 0;
                    const category = card.dataset.category;
                    const categoryVisible = activeCategories.includes(category);

                    if (matches && categoryVisible) {
                        card.classList.remove('hidden');
                    } else {
                        card.classList.add('hidden');
                    }
                });
            }

            let isExploded = false;
            let canvas = null;
            let ctx = null;
            let animationId = null;
            let particles = [];
            let originalPositions = [];

            // Function to update clear button visibility
            function updateClearButton() {
                if (searchInput.value.trim().length > 0) {
                    clearSearchButton.classList.add('visible');
                } else {
                    clearSearchButton.classList.remove('visible');
                }
            }

            // Clear search functionality
            clearSearchButton.addEventListener('click', function() {
                searchInput.value = '';
                searchInput.focus();
                updateClearButton();
                filterCards();
            });

            searchInput.addEventListener('input', function() {
                filterCards();
                // Update clear button visibility
                updateClearButton();
            });

            // Initial check for clear button
            updateClearButton();

            shakeButton.addEventListener('click', function() {
                if (isExploded) {
                    resetCards();
                } else {
                    explodeCards().catch(error => {
                        console.error('Error in explodeCards:', error);
                        resetCards(); // Reset on error
                    });
                }
            });

            categoryButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    btn.classList.toggle('active');
                    filterCards();
                });
            });

            filterCards();

            function explodeCards() {
                isExploded = true;
                shakeButton.textContent = 'üîÑ';

                // Create canvas overlay
                canvas = document.createElement('canvas');
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                canvas.style.position = 'fixed';
                canvas.style.top = '0';
                canvas.style.left = '0';
                canvas.style.zIndex = '999999';
                canvas.style.pointerEvents = 'none';

                document.body.appendChild(canvas);
                ctx = canvas.getContext('2d');

                particles = [];
                originalPositions = [];

                // Hide original cards and create placeholder particles
                cards.forEach((card, index) => {
                    if (!card.classList.contains('hidden')) {
                        const rect = card.getBoundingClientRect();
                        if (rect.width > 0 && rect.height > 0) {
                            originalPositions.push({
                                element: card,
                                left: rect.left,
                                top: rect.top
                            });

                            // Hide the card
                            card.style.display = 'none';

                            // Create triangular particles for this card
                            const numParticles = 200; // Number of triangular pieces per card

                            // Color palette: mostly white, some original colors
                            const cardColors = [
                                '#ffffff', // White
                                '#ff6b6b', '#ffa500', // Red to orange
                                '#4ecdc4', '#44a08d', // Teal to green
                                '#45b7d1', '#96c93d', // Blue to green
                                '#f093fb', '#f5576c', // Pink to red
                                '#4facfe', '#00f2fe', // Blue to cyan
                                '#43e97b', '#38f9d7', // Green to cyan
                                '#fa709a', '#fee140', // Pink to yellow
                                '#a8edea', '#fed6e3', // Light blue to pink
                                '#ff9a9e', '#fecfef', // Red to pink
                                '#ffecd2', '#fcb69f'  // Cream to orange
                            ];

                            for (let i = 0; i < numParticles; i++) {
                                // Random position within card bounds
                                const particleX = rect.left + Math.random() * rect.width;
                                const particleY = rect.top + Math.random() * rect.height;

                                // Random triangle size (5-15 pixels)
                                const size = 5 + Math.random() * 10;

                                // Random triangle shape
                                const triangle = {
                                    x1: -size/2 + (Math.random() - 0.5) * size,
                                    y1: -size/2 + (Math.random() - 0.5) * size,
                                    x2: size/2 + (Math.random() - 0.5) * size,
                                    y2: -size/2 + (Math.random() - 0.5) * size,
                                    x3: (Math.random() - 0.5) * size,
                                    y3: size/2 + (Math.random() - 0.5) * size,
                                    color: cardColors[Math.floor(Math.random() * cardColors.length)]
                                };

                                // Calculate explosion physics from card center
                                const centerX = window.innerWidth / 2;
                                const centerY = window.innerHeight / 2;
                                const cardCenterX = rect.left + rect.width / 2;
                                const cardCenterY = rect.top + rect.height / 2;

                                const dx = particleX - centerX;
                                const dy = particleY - centerY;
                                const distance = Math.sqrt(dx * dx + dy * dy);

                                const normalizedDx = dx / distance || 0;
                                const normalizedDy = dy / distance || 0;

                                const baseForce = 15 + Math.random() * 10; // Random base force
                                const distanceMultiplier = Math.min(distance / 150, 3);
                                const explosionForce = baseForce + distanceMultiplier * 10;

                                const randomAngle = (Math.random() - 0.5) * 0.8;
                                const cos = Math.cos(randomAngle);
                                const sin = Math.sin(randomAngle);

                                const finalDx = normalizedDx * cos - normalizedDy * sin;
                                const finalDy = normalizedDx * sin + normalizedDy * cos;

                                const vx = finalDx * explosionForce + (Math.random() - 0.5) * 5; // Add some randomness
                                const vy = finalDy * explosionForce + (Math.random() - 0.5) * 5;

                                particles.push({
                                    triangle: triangle,
                                    x: particleX,
                                    y: particleY,
                                    vx: vx,
                                    vy: vy,
                                    angularVelocity: (Math.random() - 0.5) * 12,
                                    rotation: Math.random() * 360,
                                    size: size
                                });
                            }
                        }
                    }
                });

                if (particles.length > 0) {
                    animate();
                } else {
                    resetCards();
                }
            }

            function resetCards() {
                isExploded = false;
                shakeButton.textContent = 'üåã';

                if (animationId) {
                    cancelAnimationFrame(animationId);
                    animationId = null;
                }

                // Remove canvas
                if (canvas) {
                    document.body.removeChild(canvas);
                    canvas = null;
                    ctx = null;
                }

                // Show original cards, respecting search filter
                cards.forEach(card => {
                    card.style.display = ''; // Remove inline style to let CSS handle visibility
                });

                particles = [];
                originalPositions = [];
            }

            function animate() {
                if (!ctx) return;

                // Clear canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                const gravity = 0.6;
                const friction = 0.985;
                const bounce = 0.8;
                const angularFriction = 0.99;

                particles.forEach(particle => {
                    // Apply gravity
                    particle.vy += gravity;

                    // Apply friction
                    particle.vx *= friction;
                    particle.vy *= friction;

                    // Apply angular friction
                    particle.angularVelocity *= angularFriction;

                    // Update position
                    particle.x += particle.vx;
                    particle.y += particle.vy;

                    // Update rotation
                    particle.rotation += particle.angularVelocity;

                    // Bounce off left and right walls
                    if (particle.x <= 0 || particle.x + particle.size >= window.innerWidth) {
                        particle.vx *= -bounce;
                        particle.x = Math.max(0, Math.min(particle.x, window.innerWidth - particle.size));
                        particle.angularVelocity += (Math.random() - 0.5) * 4;
                    }

                    // Bounce off top wall
                    if (particle.y <= 0) {
                        particle.vy *= -bounce;
                        particle.y = 0;
                        particle.angularVelocity += (Math.random() - 0.5) * 4;
                    }

                    // Ground collision - bottom of screen is ground
                    if (particle.y + particle.size >= window.innerHeight) {
                        particle.vy = 0; // Stop vertical movement
                        particle.y = window.innerHeight - particle.size; // Position on ground
                        particle.vx *= 0.95; // Extra friction on ground
                        particle.angularVelocity *= 0.9; // Reduce rotation on ground
                    }

                    // Draw triangle particle
                    try {
                        ctx.save();
                        ctx.translate(particle.x, particle.y);
                        ctx.rotate(particle.rotation * Math.PI / 180);
                        ctx.fillStyle = particle.triangle.color;
                        ctx.beginPath();
                        ctx.moveTo(particle.triangle.x1, particle.triangle.y1);
                        ctx.lineTo(particle.triangle.x2, particle.triangle.y2);
                        ctx.lineTo(particle.triangle.x3, particle.triangle.y3);
                        ctx.closePath();
                        ctx.fill();
                        ctx.restore();
                    } catch (drawError) {
                        console.error('Error drawing particle:', drawError);
                    }
                });

                // Check if particles are still moving
                const stillMoving = particles.some(p =>
                    Math.abs(p.vx) > 0.3 ||
                    Math.abs(p.vy) > 0.3 ||
                    Math.abs(p.angularVelocity) > 0.05
                );

                if (stillMoving) {
                    animationId = requestAnimationFrame(animate);
                } else {
                    // Fade out canvas and show original cards
                    let opacity = 1;
                    const fadeOut = () => {
                        opacity -= 0.05;
                        if (opacity <= 0) {
                            resetCards();
                            return;
                        }
                        canvas.style.opacity = opacity;
                        requestAnimationFrame(fadeOut);
                    };
                    setTimeout(fadeOut, 1000);
                }
            }


        });
    </script>
</body>
</html>
