<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Log - Meal Planner</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="styles.css">
    <style>
        .event-log-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .event-log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .event-log-header h1 {
            color: #2c3e50;
            font-size: 2.5rem;
            margin: 0;
        }

        .clear-log-btn {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }

        .clear-log-btn:hover {
            background: linear-gradient(135deg, #c0392b 0%, #a93226 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
        }

        .analytics-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .analytics-section-four {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .chart-container h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.4rem;
        }

        .chart-container canvas {
            max-width: 100%;
            height: 300px !important;
        }

        .log-entries {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .log-entries h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.4rem;
        }

        .log-entry {
            border: 1px solid #e1e8ed;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            background: rgba(255, 255, 255, 0.8);
        }

        .log-entry:last-child {
            margin-bottom: 0;
        }

        .log-entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .log-entry-type {
            font-weight: bold;
            font-size: 1.1rem;
            padding: 4px 8px;
            border-radius: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .log-entry-type.cook {
            background: #27ae60;
            color: white;
        }

        .log-entry-type.buy {
            background: #3498db;
            color: white;
        }

        .log-entry-type.inventory_change {
            background: #f39c12;
            color: white;
        }

        .log-entry-time {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .log-entry-details {
            color: #34495e;
            line-height: 1.5;
        }

        .log-entry-details ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .log-entry-details li {
            margin-bottom: 5px;
        }

        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: #17a2b8;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: background-color 0.2s;
            z-index: 1000;
        }

        .back-btn:hover {
            background: #138496;
        }

        .no-entries {
            text-align: center;
            color: #7f8c8d;
            font-style: italic;
            padding: 40px;
        }

        @media (max-width: 768px) {
            .event-log-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .analytics-section {
                grid-template-columns: 1fr;
            }

            .log-entry-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <button class="back-btn" onclick="window.location.href='index.html'">← Back to Meal Planner</button>

    <div id="event-log-root"></div>

    <script>
        const { useState, useEffect, useRef } = React;

        function EventLogApp() {
            const [logEntries, setLogEntries] = useState([]);
            const chartRefs = useRef({
                actionTypes: null,
                ingredientConsumption: null,
                dailyActivity: null,
                dailyCalories: null,
                dailyVitamins: null
            });

            useEffect(() => {
                loadLogEntries();
            }, []);

            const loadLogEntries = () => {
                const stored = localStorage.getItem('eventLog');
                if (stored) {
                    const entries = JSON.parse(stored);
                    // Sort by timestamp descending (newest first)
                    entries.sort((a, b) => b.timestamp - a.timestamp);
                    setLogEntries(entries);
                }
            };

            const clearLog = () => {
                if (confirm('Are you sure you want to clear all event logs? This action cannot be undone.')) {
                    localStorage.removeItem('eventLog');
                    setLogEntries([]);
                }
            };

            const formatTimestamp = (timestamp) => {
                return new Date(timestamp).toLocaleString();
            };

            const formatEventDetails = (entry) => {
                switch (entry.action) {
                    case 'cook':
                        return React.createElement('div', null,
                            React.createElement('strong', null, `Cooked: ${entry.details.recipeName}`),
                            React.createElement('ul', null,
                                entry.details.ingredientsConsumed.map((ing, idx) =>
                                    React.createElement('li', { key: idx },
                                        `${ing.name}: ${ing.quantity} ${ing.unit}`
                                    )
                                )
                            )
                        );
                    case 'buy':
                        return React.createElement('div', null,
                            React.createElement('strong', null, `Purchased items (Total: $${entry.details.totalCost.toFixed(2)})`),
                            React.createElement('ul', null,
                                entry.details.items.map((item, idx) =>
                                    React.createElement('li', { key: idx },
                                        `${item.name}: ${item.quantity} units @ $${item.unitCost.toFixed(2)} each`
                                    )
                                )
                            )
                        );
                    case 'inventory_change':
                        const change = entry.details.changeType === 'add' ? '+' : '-';
                        return React.createElement('div', null,
                            React.createElement('strong', null,
                                `${entry.details.changeType === 'add' ? 'Added to' : 'Removed from'} inventory: ${entry.details.item}`
                            ),
                            React.createElement('p', null,
                                `Quantity: ${entry.details.oldQuantity} → ${entry.details.newQuantity} (${change}${Math.abs(entry.details.newQuantity - entry.details.oldQuantity)})`
                            )
                        );
                    default:
                        return React.createElement('div', null, JSON.stringify(entry.details, null, 2));
                }
            };

            // Generate analytics data
            const generateAnalyticsData = () => {
                const recipeFrequency = {};
                const ingredientConsumption = {};
                const nutrientConsumption = { calories: 0, protein: 0, carbs: 0, fat: 0, fiber: 0 };
                const dailyActivity = {};
                const dailyVitaminConsumption = {}; // Track vitamins and calories per day

                logEntries.forEach(entry => {
                    // Track recipe cooking frequency
                    if (entry.action === 'cook') {
                        recipeFrequency[entry.details.recipeName] = (recipeFrequency[entry.details.recipeName] || 0) + 1;

                        const date = new Date(entry.timestamp).toDateString();
                        if (!dailyVitaminConsumption[date]) {
                            dailyVitaminConsumption[date] = {
                                calories: 0,
                                vitaminA: 0, vitaminC: 0, vitaminD: 0, vitaminE: 0,
                                vitaminK1: 0, vitaminK2: 0, vitaminB12: 0, folate: 0
                            };
                        }

                        // Track ingredient consumption with nutritional data
                        entry.details.ingredientsConsumed.forEach(ing => {
                            ingredientConsumption[ing.name] = (ingredientConsumption[ing.name] || 0) + ing.quantity;

                            // Add nutritional data if available (simplified - in real app would need ingredient database)
                            // For now, just track basic nutrients based on common ingredients
                            const nutritionData = getBasicNutritionData(ing.name);
                            if (nutritionData) {
                                nutrientConsumption.calories += nutritionData.calories * ing.quantity;
                                nutrientConsumption.protein += nutritionData.protein * ing.quantity;
                                nutrientConsumption.carbs += nutritionData.carbs * ing.quantity;
                                nutrientConsumption.fat += nutritionData.fat * ing.quantity;
                                nutrientConsumption.fiber += nutritionData.fiber * ing.quantity;

                                // Track daily vitamin and calorie consumption
                                dailyVitaminConsumption[date].calories += nutritionData.calories * ing.quantity;
                                if (nutritionData.vitamins) {
                                    dailyVitaminConsumption[date].vitaminA += nutritionData.vitamins.vitaminA ? ing.quantity : 0;
                                    dailyVitaminConsumption[date].vitaminC += nutritionData.vitamins.vitaminC ? ing.quantity : 0;
                                    dailyVitaminConsumption[date].vitaminD += nutritionData.vitamins.vitaminD ? ing.quantity : 0;
                                    dailyVitaminConsumption[date].vitaminE += nutritionData.vitamins.vitaminE ? ing.quantity : 0;
                                    dailyVitaminConsumption[date].vitaminK1 += nutritionData.vitamins.vitaminK1 ? ing.quantity : 0;
                                    dailyVitaminConsumption[date].vitaminK2 += nutritionData.vitamins.vitaminK2 ? ing.quantity : 0;
                                    dailyVitaminConsumption[date].vitaminB12 += nutritionData.vitamins.vitaminB12 ? ing.quantity : 0;
                                    dailyVitaminConsumption[date].folate += nutritionData.vitamins.folate ? ing.quantity : 0;
                                }
                            }
                        });
                    }

                    // Track daily activity
                    const date = new Date(entry.timestamp).toDateString();
                    dailyActivity[date] = (dailyActivity[date] || 0) + 1;
                });

                return { recipeFrequency, ingredientConsumption, nutrientConsumption, dailyActivity, dailyVitaminConsumption };
            };

            // Basic nutrition data for common ingredients (simplified)
            const getBasicNutritionData = (ingredientName) => {
                const nutritionDB = {
                    'chicken breast': {
                        calories: 165, protein: 31, carbs: 0, fat: 3.6, fiber: 0,
                        vitamins: { vitaminA: false, vitaminC: false, vitaminD: false, vitaminE: false, vitaminK1: false, vitaminK2: false, vitaminB12: true, folate: false }
                    },
                    'salmon': {
                        calories: 206, protein: 22, carbs: 0, fat: 13, fiber: 0,
                        vitamins: { vitaminA: false, vitaminC: false, vitaminD: true, vitaminE: false, vitaminK1: false, vitaminK2: false, vitaminB12: true, folate: false }
                    },
                    'brown rice': {
                        calories: 216, protein: 5, carbs: 44, fat: 1.8, fiber: 3.5,
                        vitamins: { vitaminA: false, vitaminC: false, vitaminD: false, vitaminE: false, vitaminK1: false, vitaminK2: false, vitaminB12: false, folate: false }
                    },
                    'broccoli': {
                        calories: 34, protein: 2.8, carbs: 7, fat: 0.4, fiber: 2.6,
                        vitamins: { vitaminA: true, vitaminC: true, vitaminD: false, vitaminE: false, vitaminK1: true, vitaminK2: false, vitaminB12: false, folate: true }
                    },
                    'spinach': {
                        calories: 23, protein: 2.9, carbs: 3.6, fat: 0.4, fiber: 2.2,
                        vitamins: { vitaminA: true, vitaminC: true, vitaminD: false, vitaminE: false, vitaminK1: true, vitaminK2: false, vitaminB12: false, folate: true }
                    },
                    'eggs': {
                        calories: 155, protein: 13, carbs: 1.1, fat: 11, fiber: 0,
                        vitamins: { vitaminA: true, vitaminC: false, vitaminD: true, vitaminE: false, vitaminK1: false, vitaminK2: true, vitaminB12: true, folate: false }
                    },
                    'milk': {
                        calories: 61, protein: 3.2, carbs: 4.8, fat: 3.3, fiber: 0,
                        vitamins: { vitaminA: true, vitaminC: false, vitaminD: true, vitaminE: false, vitaminK1: false, vitaminK2: false, vitaminB12: true, folate: false }
                    },
                    'cheese': {
                        calories: 402, protein: 7, carbs: 3.4, fat: 33, fiber: 0,
                        vitamins: { vitaminA: true, vitaminC: false, vitaminD: false, vitaminE: false, vitaminK1: false, vitaminK2: true, vitaminB12: false, folate: false }
                    },
                    'olive oil': {
                        calories: 884, protein: 0, carbs: 0, fat: 100, fiber: 0,
                        vitamins: { vitaminA: false, vitaminC: false, vitaminD: false, vitaminE: true, vitaminK1: false, vitaminK2: false, vitaminB12: false, folate: false }
                    },
                    'flour': {
                        calories: 361, protein: 12, carbs: 76, fat: 1, fiber: 2.7,
                        vitamins: { vitaminA: false, vitaminC: false, vitaminD: false, vitaminE: false, vitaminK1: false, vitaminK2: false, vitaminB12: false, folate: true }
                    },
                    'sugar': {
                        calories: 387, protein: 0, carbs: 100, fat: 0, fiber: 0,
                        vitamins: { vitaminA: false, vitaminC: false, vitaminD: false, vitaminE: false, vitaminK1: false, vitaminK2: false, vitaminB12: false, folate: false }
                    },
                    'butter': {
                        calories: 717, protein: 0.9, carbs: 0.1, fat: 81, fiber: 0,
                        vitamins: { vitaminA: true, vitaminC: false, vitaminD: true, vitaminE: false, vitaminK1: false, vitaminK2: true, vitaminB12: false, folate: false }
                    },
                    'potatoes': {
                        calories: 77, protein: 2, carbs: 17, fat: 0.1, fiber: 2.2,
                        vitamins: { vitaminA: false, vitaminC: true, vitaminD: false, vitaminE: false, vitaminK1: false, vitaminK2: false, vitaminB12: false, folate: false }
                    },
                    'onions': {
                        calories: 40, protein: 1.1, carbs: 9.3, fat: 0.1, fiber: 1.7,
                        vitamins: { vitaminA: false, vitaminC: true, vitaminD: false, vitaminE: false, vitaminK1: false, vitaminK2: false, vitaminB12: false, folate: false }
                    },
                    'garlic': {
                        calories: 149, protein: 6.4, carbs: 33, fat: 0.5, fiber: 2.1,
                        vitamins: { vitaminA: false, vitaminC: true, vitaminD: false, vitaminE: false, vitaminK1: false, vitaminK2: false, vitaminB12: false, folate: false }
                    },
                    'tomatoes': {
                        calories: 18, protein: 0.9, carbs: 3.9, fat: 0.2, fiber: 1.2,
                        vitamins: { vitaminA: true, vitaminC: true, vitaminD: false, vitaminE: false, vitaminK1: true, vitaminK2: false, vitaminB12: false, folate: false }
                    },
                    'carrots': {
                        calories: 41, protein: 0.9, carbs: 9.6, fat: 0.2, fiber: 2.8,
                        vitamins: { vitaminA: true, vitaminC: false, vitaminD: false, vitaminE: false, vitaminK1: true, vitaminK2: false, vitaminB12: false, folate: false }
                    },
                    'lettuce': {
                        calories: 15, protein: 1.4, carbs: 2.9, fat: 0.2, fiber: 1.3,
                        vitamins: { vitaminA: true, vitaminC: false, vitaminD: false, vitaminE: false, vitaminK1: true, vitaminK2: false, vitaminB12: false, folate: true }
                    },
                    'apples': {
                        calories: 52, protein: 0.3, carbs: 14, fat: 0.2, fiber: 2.4,
                        vitamins: { vitaminA: false, vitaminC: true, vitaminD: false, vitaminE: false, vitaminK1: false, vitaminK2: false, vitaminB12: false, folate: false }
                    },
                    'bananas': {
                        calories: 89, protein: 1.1, carbs: 23, fat: 0.3, fiber: 2.6,
                        vitamins: { vitaminA: false, vitaminC: true, vitaminD: false, vitaminE: false, vitaminK1: false, vitaminK2: false, vitaminB12: false, folate: false }
                    },
                    'oranges': {
                        calories: 47, protein: 0.9, carbs: 12, fat: 0.1, fiber: 2.4,
                        vitamins: { vitaminA: false, vitaminC: true, vitaminD: false, vitaminE: false, vitaminK1: false, vitaminK2: false, vitaminB12: false, folate: true }
                    },
                    'beef': {
                        calories: 250, protein: 26, carbs: 0, fat: 17, fiber: 0,
                        vitamins: { vitaminA: false, vitaminC: false, vitaminD: false, vitaminE: false, vitaminK1: false, vitaminK2: false, vitaminB12: true, folate: false }
                    },
                    'pork': {
                        calories: 242, protein: 27, carbs: 0, fat: 14, fiber: 0,
                        vitamins: { vitaminA: false, vitaminC: false, vitaminD: false, vitaminE: false, vitaminK1: false, vitaminK2: false, vitaminB12: true, folate: false }
                    },
                    'turkey': {
                        calories: 135, protein: 30, carbs: 0, fat: 1, fiber: 0,
                        vitamins: { vitaminA: false, vitaminC: false, vitaminD: false, vitaminE: false, vitaminK1: false, vitaminK2: false, vitaminB12: true, folate: false }
                    },
                    'tuna': {
                        calories: 144, protein: 25, carbs: 0, fat: 4.9, fiber: 0,
                        vitamins: { vitaminA: false, vitaminC: false, vitaminD: true, vitaminE: false, vitaminK1: false, vitaminK2: false, vitaminB12: true, folate: false }
                    },
                    'tofu': {
                        calories: 76, protein: 8, carbs: 1.9, fat: 4.8, fiber: 0.3,
                        vitamins: { vitaminA: false, vitaminC: false, vitaminD: false, vitaminE: false, vitaminK1: false, vitaminK2: false, vitaminB12: false, folate: false }
                    },
                    'quinoa': {
                        calories: 222, protein: 8.1, carbs: 39, fat: 3.6, fiber: 5.2,
                        vitamins: { vitaminA: false, vitaminC: false, vitaminD: false, vitaminE: true, vitaminK1: false, vitaminK2: false, vitaminB12: false, folate: true }
                    },
                    'oats': {
                        calories: 379, protein: 13, carbs: 67, fat: 6.9, fiber: 10,
                        vitamins: { vitaminA: false, vitaminC: false, vitaminD: false, vitaminE: false, vitaminK1: false, vitaminK2: false, vitaminB12: false, folate: false }
                    },
                    'nuts': {
                        calories: 607, protein: 21, carbs: 21, fat: 54, fiber: 8.7,
                        vitamins: { vitaminA: false, vitaminC: false, vitaminD: false, vitaminE: true, vitaminK1: false, vitaminK2: false, vitaminB12: false, folate: false }
                    },
                    'seeds': {
                        calories: 559, protein: 32, carbs: 28, fat: 49, fiber: 10,
                        vitamins: { vitaminA: false, vitaminC: false, vitaminD: false, vitaminE: true, vitaminK1: false, vitaminK2: false, vitaminB12: false, folate: false }
                    },
                    'avocado': {
                        calories: 160, protein: 2, carbs: 8.5, fat: 15, fiber: 6.7,
                        vitamins: { vitaminA: false, vitaminC: true, vitaminD: false, vitaminE: true, vitaminK1: true, vitaminK2: false, vitaminB12: false, folate: true }
                    },
                    'yogurt': {
                        calories: 61, protein: 3.5, carbs: 4.7, fat: 3.3, fiber: 0,
                        vitamins: { vitaminA: false, vitaminC: false, vitaminD: true, vitaminE: false, vitaminK1: false, vitaminK2: false, vitaminB12: true, folate: false }
                    },
                    'bread': {
                        calories: 265, protein: 9, carbs: 49, fat: 3.2, fiber: 2.7,
                        vitamins: { vitaminA: false, vitaminC: false, vitaminD: false, vitaminE: false, vitaminK1: false, vitaminK2: false, vitaminB12: false, folate: true }
                    },
                    'pasta': {
                        calories: 157, protein: 5.8, carbs: 31, fat: 0.9, fiber: 1.8,
                        vitamins: { vitaminA: false, vitaminC: false, vitaminD: false, vitaminE: false, vitaminK1: false, vitaminK2: false, vitaminB12: false, folate: false }
                    }
                };

                const lowerName = ingredientName.toLowerCase();
                return nutritionDB[lowerName] || null;
            };

            const analytics = generateAnalyticsData();

            useEffect(() => {
                // Destroy existing charts
                Object.values(chartRefs.current).forEach(chart => {
                    if (chart) {
                        chart.destroy();
                    }
                });

                // Most cooked recipes chart
                const recipeCtx = document.getElementById('actionTypesChart');
                if (recipeCtx && Object.keys(analytics.recipeFrequency).length > 0) {
                    const topRecipes = Object.entries(analytics.recipeFrequency)
                        .sort(([,a], [,b]) => b - a)
                        .slice(0, 10);

                    chartRefs.current.actionTypes = new Chart(recipeCtx, {
                        type: 'bar',
                        data: {
                            labels: topRecipes.map(([name]) => name.length > 15 ? name.substring(0, 15) + '...' : name),
                            datasets: [{
                                label: 'Times Cooked',
                                data: topRecipes.map(([, count]) => count),
                                backgroundColor: '#27ae60',
                                borderColor: '#229954',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        stepSize: 1
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    display: false
                                }
                            }
                        }
                    });
                }

                // Nutrient consumption chart
                const nutrientCtx = document.getElementById('ingredientConsumptionChart');
                if (nutrientCtx && analytics.nutrientConsumption.calories > 0) {
                    const nutrients = [
                        { name: 'Calories', value: analytics.nutrientConsumption.calories, color: '#e74c3c' },
                        { name: 'Protein (g)', value: analytics.nutrientConsumption.protein, color: '#3498db' },
                        { name: 'Carbs (g)', value: analytics.nutrientConsumption.carbs, color: '#f39c12' },
                        { name: 'Fat (g)', value: analytics.nutrientConsumption.fat, color: '#9b59b6' },
                        { name: 'Fiber (g)', value: analytics.nutrientConsumption.fiber, color: '#27ae60' }
                    ];

                    chartRefs.current.ingredientConsumption = new Chart(nutrientCtx, {
                        type: 'bar',
                        data: {
                            labels: nutrients.map(n => n.name),
                            datasets: [{
                                label: 'Total Consumed',
                                data: nutrients.map(n => n.value),
                                backgroundColor: nutrients.map(n => n.color),
                                borderWidth: 1,
                                borderColor: '#fff'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            },
                            plugins: {
                                legend: {
                                    display: false
                                }
                            }
                        }
                    });
                }

                // Daily activity chart
                const dailyCtx = document.getElementById('dailyActivityChart');
                if (dailyCtx && Object.keys(analytics.dailyActivity).length > 0) {
                    const sortedDays = Object.entries(analytics.dailyActivity)
                        .sort(([a], [b]) => new Date(a) - new Date(b));

                    chartRefs.current.dailyActivity = new Chart(dailyCtx, {
                        type: 'line',
                        data: {
                            labels: sortedDays.map(([date]) => new Date(date).toLocaleDateString()),
                            datasets: [{
                                label: 'Activities',
                                data: sortedDays.map(([, count]) => count),
                                borderColor: '#27ae60',
                                backgroundColor: 'rgba(39, 174, 96, 0.1)',
                                tension: 0.4,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        stepSize: 1
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    display: false
                                }
                            }
                        }
                    });
                }

                // Daily calories line chart
                const caloriesCtx = document.getElementById('dailyCaloriesChart');
                if (caloriesCtx && Object.keys(analytics.dailyVitaminConsumption).length > 0) {
                    const sortedDays = Object.entries(analytics.dailyVitaminConsumption)
                        .sort(([a], [b]) => new Date(a) - new Date(b))
                        .slice(-7); // Show last 7 days

                    chartRefs.current.dailyCalories = new Chart(caloriesCtx, {
                        type: 'line',
                        data: {
                            labels: sortedDays.map(([date]) => new Date(date).toLocaleDateString()),
                            datasets: [{
                                label: 'Calories Consumed',
                                data: sortedDays.map(([, dayData]) => dayData.calories),
                                borderColor: '#e74c3c',
                                backgroundColor: 'rgba(231, 76, 60, 0.1)',
                                tension: 0.4,
                                fill: true,
                                pointBackgroundColor: '#e74c3c',
                                pointBorderColor: '#c0392b',
                                pointBorderWidth: 2,
                                pointRadius: 5
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            return value.toLocaleString();
                                        }
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    display: false
                                }
                            }
                        }
                    });
                }

                // Daily vitamins stacked bar chart
                const vitaminsCtx = document.getElementById('dailyVitaminsChart');
                if (vitaminsCtx && Object.keys(analytics.dailyVitaminConsumption).length > 0) {
                    const sortedDays = Object.entries(analytics.dailyVitaminConsumption)
                        .sort(([a], [b]) => new Date(a) - new Date(b))
                        .slice(-7); // Show last 7 days

                    chartRefs.current.dailyVitamins = new Chart(vitaminsCtx, {
                        type: 'bar',
                        data: {
                            labels: sortedDays.map(([date]) => new Date(date).toLocaleDateString()),
                            datasets: [
                                {
                                    label: 'Vitamin A',
                                    data: sortedDays.map(([, dayData]) => dayData.vitaminA),
                                    backgroundColor: '#f39c12',
                                    borderColor: '#e67e22',
                                    borderWidth: 1
                                },
                                {
                                    label: 'Vitamin C',
                                    data: sortedDays.map(([, dayData]) => dayData.vitaminC),
                                    backgroundColor: '#27ae60',
                                    borderColor: '#229954',
                                    borderWidth: 1
                                },
                                {
                                    label: 'Vitamin D',
                                    data: sortedDays.map(([, dayData]) => dayData.vitaminD),
                                    backgroundColor: '#3498db',
                                    borderColor: '#2980b9',
                                    borderWidth: 1
                                },
                                {
                                    label: 'Vitamin E',
                                    data: sortedDays.map(([, dayData]) => dayData.vitaminE),
                                    backgroundColor: '#9b59b6',
                                    borderColor: '#8e44ad',
                                    borderWidth: 1
                                },
                                {
                                    label: 'Vitamin K1',
                                    data: sortedDays.map(([, dayData]) => dayData.vitaminK1),
                                    backgroundColor: '#e67e22',
                                    borderColor: '#d35400',
                                    borderWidth: 1
                                },
                                {
                                    label: 'Vitamin K2',
                                    data: sortedDays.map(([, dayData]) => dayData.vitaminK2),
                                    backgroundColor: '#16a085',
                                    borderColor: '#138f7a',
                                    borderWidth: 1
                                },
                                {
                                    label: 'Vitamin B12',
                                    data: sortedDays.map(([, dayData]) => dayData.vitaminB12),
                                    backgroundColor: '#8e44ad',
                                    borderColor: '#7d3c98',
                                    borderWidth: 1
                                },
                                {
                                    label: 'Folate',
                                    data: sortedDays.map(([, dayData]) => dayData.folate),
                                    backgroundColor: '#d35400',
                                    borderColor: '#a04000',
                                    borderWidth: 1
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                x: {
                                    stacked: true
                                },
                                y: {
                                    stacked: true,
                                    beginAtZero: true,
                                    ticks: {
                                        stepSize: 1
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    labels: {
                                        boxWidth: 12,
                                        font: {
                                            size: 11
                                        }
                                    }
                                }
                            }
                        }
                    });
                }

                // Cleanup function to destroy charts when component unmounts
                return () => {
                    Object.values(chartRefs.current).forEach(chart => {
                        if (chart) {
                            chart.destroy();
                        }
                    });
                };
            }, [logEntries]);

            return React.createElement('div', { className: 'event-log-container' },
                React.createElement('div', { className: 'event-log-header' },
                    React.createElement('h1', null, 'Event Log & Analytics'),
                    React.createElement('button', {
                        className: 'clear-log-btn',
                        onClick: clearLog,
                        disabled: logEntries.length === 0
                    }, 'Clear Log')
                ),

                React.createElement('div', { className: 'analytics-section' },
                    React.createElement('div', { className: 'chart-container' },
                        React.createElement('h3', null, 'Most Cooked Recipes'),
                        React.createElement('canvas', { id: 'actionTypesChart' })
                    ),
                    React.createElement('div', { className: 'chart-container' },
                        React.createElement('h3', null, 'Nutrient Consumption'),
                        React.createElement('canvas', { id: 'ingredientConsumptionChart' })
                    ),
                    React.createElement('div', { className: 'chart-container' },
                        React.createElement('h3', null, 'Daily Activity'),
                        React.createElement('canvas', { id: 'dailyActivityChart' })
                    )
                ),

                React.createElement('div', { className: 'analytics-section-four' },
                    React.createElement('div', { className: 'chart-container' },
                        React.createElement('h3', null, 'Daily Calories'),
                        React.createElement('canvas', { id: 'dailyCaloriesChart' })
                    ),
                    React.createElement('div', { className: 'chart-container' },
                        React.createElement('h3', null, 'Daily Vitamins'),
                        React.createElement('canvas', { id: 'dailyVitaminsChart' })
                    )
                ),

                React.createElement('div', { className: 'log-entries' },
                    React.createElement('h3', null, `Log Entries (${logEntries.length})`),
                    logEntries.length === 0
                        ? React.createElement('div', { className: 'no-entries' }, 'No events logged yet. Start cooking, shopping, or managing inventory to see activity here.')
                        : logEntries.map((entry, index) =>
                            React.createElement('div', { key: index, className: 'log-entry' },
                                React.createElement('div', { className: 'log-entry-header' },
                                    React.createElement('span', { className: `log-entry-type ${entry.action}` }, entry.action.replace('_', ' ')),
                                    React.createElement('span', { className: 'log-entry-time' }, formatTimestamp(entry.timestamp))
                                ),
                                React.createElement('div', { className: 'log-entry-details' },
                                    formatEventDetails(entry)
                                )
                            )
                        )
                )
            );
        }

        ReactDOM.render(React.createElement(EventLogApp), document.getElementById('event-log-root'));
    </script>
</body>
</html>
