<!DOCTYPE html>
<html>
<head>
    <title>Image Background Remover</title>
</head>
<body>
    <button id="loadImageButton">Load Image from Clipboard</button>
    <canvas id="imageCanvas"></canvas>
    <a id="downloadLink" download="processed-image.png" style="display:none;">Download Image</a>
    <script>
        document.getElementById('loadImageButton').addEventListener('click', async () => {
            try {
                const items = await navigator.clipboard.read();
                for (const item of items) {
                    if (item.types.includes('image/png') || item.types.includes('image/jpeg')) {
                        const blob = await item.getType('image/png'); // Prefer PNG
                        const url = URL.createObjectURL(blob);
                        const img = new Image();
                        img.src = url;
                        img.onload = () => {
                            const canvas = document.getElementById('imageCanvas');
                            const ctx = canvas.getContext('2d');
                            canvas.width = img.width;
                            canvas.height = img.height;
                            ctx.drawImage(img, 0, 0);
                            processBackgroundRemoval(ctx, canvas);
                        };
                    }
                }
            } catch (err) {
                console.error('Failed to read clipboard image:', err);
            }
        });

        function processBackgroundRemoval(ctx, canvas) {
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];
                // Simple threshold for white background
                if (r > 245 && g > 245 && b > 245) {
                    data[i + 3] = 0; // Set alpha to 0 for transparency
                }
            }
            ctx.putImageData(imageData, 0, 0);
        }

        // Auto-download after processing
        setTimeout(() => {
            const canvas = document.getElementById('imageCanvas');
            const downloadLink = document.getElementById('downloadLink');
            downloadLink.href = canvas.toDataURL();
            downloadLink.style.display = 'inline';
        }, 1000);
    </script>
</body>
</html>